# Порівняння Docker образів ML-сервісу

## 1. Розмір образів
- ml-fatetest: 20.54 GB
- ml-slimtest:  8.4 GB

## 2. Кількість шарів
- ml-fatetest: 20
- ml-slimtest: 17

## 3. Присутність зайвих інструментів
- ml-fatetest:
  - Повні пакети для розробки та компіляції (git, mercurial, openssh, imagemagick, dev-бібліотеки)
  - Встановлення Python-бібліотек без обмежень
  - Великий розмір через системні та dev-залежності, які потрібні лише для збірки

- ml-slimtest:
  - Multi-stage build: на другому етапі лише необхідні файли та Python-залежності
  - Відсутні dev-пакети та зайві утиліти
  - Менший розмір та легше підтримувати

## 4. Оптимізація

### - Вже застосовано для оптимізації ml-slimtest
  - Slim-базовий образ (використовується python:3.10-slim).
  - Кешування пакетів pip (--no-cache-dir в pip install).
  - PyTorch cpu-only (у requirements.txt torch без +cu*, з extra-index-url для CPU).

### - Пропозиції з подальшої оптимізації
1. **Видаляти тимчасові файли і документацію після інсталяцій**  
   - Зараз `COPY --from=builder /build/deps /app/deps` переносить всі залежності, разом з кешованими `.pyc`, документацією та зайвими файлами.  
   - Можна додати на етапі builder:
     ```dockerfile
     RUN find /build/deps -type d -name "__pycache__" -exec rm -rf {} + \
         && find /build/deps -type f -name "*.pyc" -delete
     ```
   - **Вплив:** зменшення розміру образу на сотні МБ без втрати функціоналу.

2. **Об’єднати RUN команди**  
   - На етапі builder зараз окремо встановлюються пакети (`pip install`) і копіюються файли.  
   - Можна об’єднати кілька RUN команд в один, наприклад видаляти кеш одразу після інсталяції.  
   - **Вплив:** зменшення кількості шарів Docker, ще трохи зменшує розмір і пришвидшує build.

3. **Розглянути використання готового slim PyTorch CPU образу**  
   - Наприклад: `FROM pytorch/pytorch:2.9.1-cpu`  
   - Він вже містить оптимізований PyTorch і залежності, не потрібно збирати CPU версію заново.  
   - **Вплив:** може значно зменшити розмір образу (скорочує 1–2 GB) і пришвидшити build.
